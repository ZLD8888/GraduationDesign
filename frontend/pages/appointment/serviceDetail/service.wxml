<view class="container">
  <view class="service-detail" wx:if="{{service}}">
    <image class="service-image" src="{{service.imageUrl}}" mode="aspectFit"></image>
    
    <view class="service-info">
      <view class="header">
        <text class="name">{{service.name}}</text>
        <text class="price">Â¥{{service.price}}/æ¬¡</text>
      </view>
      
      <view class="description">
        <text class="section-title">æœåŠ¡æè¿°</text>
        <text class="desc-text">{{service.description}}</text>
      </view>

      <!-- é¢„çº¦è¡¨å• -->
      <block wx:if="{{canBook}}">
        <view class="booking-form">
          <view class="booking-header">
            <text class="section-title">é¢„çº¦ä¿¡æ¯</text>
            <text class="service-selected">å·²é€‰ï¼š{{service.name}}</text>
          </view>
          
          <view class="form-item">
            <view class="form-label">
              <text class="label-icon">ğŸ“…</text>
              <text class="label-text">é€‰æ‹©æ—¥æœŸ</text>
            </view>
            <view class="available-days">
              å¯é¢„çº¦æ—¥æœŸï¼š
              <block wx:for="{{availableDays}}" wx:key="*this">
                <text wx:if="{{item === '0'}}">å‘¨æ—¥</text>
                <text wx:elif="{{item === '1'}}">å‘¨ä¸€</text>
                <text wx:elif="{{item === '2'}}">å‘¨äºŒ</text>
                <text wx:elif="{{item === '3'}}">å‘¨ä¸‰</text>
                <text wx:elif="{{item === '4'}}">å‘¨å››</text>
                <text wx:elif="{{item === '5'}}">å‘¨äº”</text>
                <text wx:elif="{{item === '6'}}">å‘¨å…­</text>
                <text wx:if="{{index < availableDays.length - 1}}">ã€</text>
              </block>
            </view>
            <picker mode="date" 
              value="{{selectedDate}}" 
              start="{{today}}" 
              end="{{maxDate}}" 
              bindchange="handleDateChange"
            >
              <view class="picker">{{selectedDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
            </picker>
          </view>

          <view class="form-item" wx:if="{{selectedDate}}">
            <view class="form-label">
              <text class="label-icon">ğŸ•’</text>
              <text class="label-text">é€‰æ‹©æ—¶é—´ ({{startTime}}-{{endTime}})</text>
            </view>
            <view class="appointment-info">
              <text>æ¯æ—¥æœ€å¤§é¢„çº¦æ•°: {{maxAppointments}}</text>
              <text>å·²é¢„çº¦: {{appointedCount}}</text>
              <text>å‰©ä½™å¯é¢„çº¦: {{remainingSlots}}</text>
            </view>
            <block wx:if="{{remainingSlots > 0}}">
              <view class="time-slots" wx:if="{{timeList && timeList.length > 0}}">
                <view 
                  wx:for="{{timeList}}" 
                  wx:key="*this"
                  class="time-slot {{selectedTime === item ? 'selected' : ''}}"
                  bindtap="handleTimeSelect"
                  data-time="{{item}}"
                >
                  <text>{{item}}</text>
                </view>
              </view>
              <text class="no-slots" wx:else>å½“å‰æ—¥æœŸæ²¡æœ‰å¯ç”¨æ—¶é—´æ®µ</text>
            </block>
            <view class="no-slots" wx:else>
              å½“æ—¥é¢„çº¦å·²æ»¡ï¼Œè¯·é€‰æ‹©å…¶ä»–æ—¥æœŸ
            </view>
          </view>

          <view class="form-item" wx:if="{{isFamily}}">
            <view class="form-label">
              <text class="label-icon">ğŸ‘¤</text>
              <text class="label-text">é€‰æ‹©è€äºº</text>
            </view>
            <picker bindchange="handleElderlyChange" value="{{selectedElderly}}" range="{{boundElderlyList}}" range-key="name">
              <view class="picker">{{selectedElderly !== '' ? boundElderlyList[selectedElderly].name : 'è¯·é€‰æ‹©è€äºº'}}</view>
            </picker>
          </view>

          <button class="book-btn" bindtap="createAppointment">
            <text class="btn-text">ç«‹å³é¢„çº¦</text>
            <text class="btn-price">Â¥{{service.price}}</text>
          </button>
        </view>
      </block>
    </view>
  </view>
</view> 